<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>jQuery实现照片瀑布流</title>
	<link rel="stylesheet" type="text/css" href="css/waterFall.css">
</head>
<body>
	<header>
		Beautiful southern girl
		<nav>
			<ul>
				<li><a href="js.html">JS</a></li>
				<li><a href="index.html">jQuery</a></li>
				<li><a href="navtrack.html">Nav</a></li>			
			</ul>
		</nav>
	</header>
	<div id="main">
		<div class="box">
			<div class="pic">
				<img src="images/1.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/2.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/3.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/4.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/5.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/6.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/7.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/8.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/9.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/10.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/11.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/12.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/13.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/14.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/15.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/16.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/17.jpg">
			</div>
		</div>
		<!-- <div class="box">
			<div class="pic">
				<img src="images/18.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/19.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/20.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/21.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/22.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/23.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/24.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/25.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/26.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/27.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/28.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/29.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/30.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/31.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/32.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/33.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/34.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/35.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/36.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/37.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/38.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/39.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/40.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/41.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/42.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/43.jpg">
			</div>
		</div>
		<div class="box">
			<div class="pic">
				<img src="images/44.jpg">
			</div>
		</div> -->
	</div>
</body>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript">
	//瀑布流原理，第二排以及后面的照片，要依次定位在前面一排的最矮的照片后面
	$(window).on('load',function(){
		waterfall();
		
		var dataInt={"data":[{"src":"18.jpg"},{"src":"19.jpg"},{"src":"20.jpg"},{"src":"21.jpg"},{"src":"22.jpg"},{"src":"23.jpg"},{"src":"24.jpg"},{"src":"25.jpg"},{"src":"26.jpg"},{"src":"27.jpg"},{"src":"28.jpg"},{"src":"29.jpg"},{"src":"30.jpg"},{"src":"31.jpg"},{"src":"32.jpg"},{"src":"33.jpg"},{"src":"34.jpg"},{"src":"35.jpg"},{"src":"36.jpg"},{"src":"37.jpg"},{"src":"38.jpg"},{"src":"39.jpg"},{"src":"40.jpg"},{"src":"41.jpg"},{"src":"42.jpg"},{"src":"43.jpg"},{"src":"44.jpg"},{"src":"0.jpg"},{"src":"1.jpg"},{"src":"2.jpg"},{"src":"3.jpg"},{"src":"4.jpg"},{"src":"5.jpg"},{"src":"6.jpg"},{"src":"7.jpg"},{"src":"8.jpg"},{"src":"9.jpg"},{"src":"10.jpg"},{"src":"11.jpg"},{"src":"12.jpg"},{"src":"13.jpg"},{"src":"14.jpg"},{"src":"15.jpg"},{"src":"16.jpg"},{"src":"17.jpg"}]};
		$(window).on('scroll',function(){
			if(checkScroll){
				$(dataInt.data).each(function(index,value){
					var oBox=$("<div>").addClass("box").appendTo($("#main"));
					var oPic=$("<div>").addClass("pic").appendTo(oBox);
					var oImg=$("<img>").attr("src","images/"+$(value).attr("src")).appendTo(oPic);
				})
				waterfall();
			}
		})	
	})
	
	function waterfall(){
		var $Boxs=$("#main").children(".box");//获取每个box盒子
		var BoxWidth=$Boxs.eq(0).outerWidth();//获取盒子的宽度outerWidth()获取连padding;注意：jQuery对象才能使用jQuery的函数，用$()转换
		var bodyWidth=$(document).width();
		var cols=Math.floor(bodyWidth/BoxWidth);
		$("#main").width(cols*BoxWidth).css('margin','0 auto');
		// console.log(BoxWidth);
		var Harr=[];//新建用来存放每列现有的高度数组Harr
		//遍历每个盒子
		$Boxs.each(function(index,value){
			var h=$Boxs.eq(index).outerHeight();
			//先把第一列每个元素的高度存入Harr数组中
			if(index<cols){
				Harr.push(h);
			}else{
				//给box设置绝对定位
				$Boxs.eq(index).css('position','absolute');
				//获取最小高度和它的索引
				var minH=Math.min.apply(null,Harr);
				var minHindex=$.inArray(minH,Harr);
				//给下一个box设置top、left值
				$Boxs.eq(index).css({
					'top':minH,
					'left':minHindex*BoxWidth
				})
				//更新Harr数组
				Harr[minHindex]+=$Boxs.eq(index).outerHeight();
			}
		})
	}

	function checkScroll(){
		var $lastBox=$("#main>div").last();
		var lastBoxH=$lastBox.offset().top+Math.floor($lastBox.outerHeight()/2);
		var scrollTop=$(window).scrollTop();
		var documentH=$(window).height();
		console.log(scrollTop);
		return (lastBoxH<scrollTop+documentH)?true:false;
	}
</script>
</html>